<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Profil de {{ user.name }}</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        /* Style des publications */
        .post-container {
            background-color: #fff;
            border-radius: var(--radius-md);
            box-shadow: 4px 4px 10px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }

        .post-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .post-content {
            font-size: 1.1rem;
            color: #333;
            background-color: #fff;
            border-radius: var(--radius-sm);
            padding: 15px;
            margin: 10px 0;
        }

        /* Section des commentaires */
        .comment-section {
            background-color: var(--background-2);
            border-radius: var(--radius-sm);
            padding: 10px;
            margin-top: 10px;
        }

        .comment {
            padding: 8px 10px;
            margin-bottom: 6px;
            background-color: rgba(255,255,255,0.8);
            border-radius: var(--radius-sm);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .comment small {
            flex: 1;
        }

        .comment form {
            margin-left: 10px;
        }

        .comment form button {
            font-size: 0.7rem;
            padding: 4px 8px;
        }

        .comment-input {
            display: flex;
            width: 100%;
            margin-top: 8px;
        }

        .comment-input input {
            flex: 1;
            padding: 8px;
            border-radius: var(--radius-sm) 0 0 var(--radius-sm);
            border: 1px solid #ccc;
        }

        .comment-input button {
            border-radius: 0 var(--radius-sm) var(--radius-sm) 0;
        }

        .like-post {
            display: flex;
            justify-content: flex-end;
            margin-top: 8px;
        }

        .like-post button {
            font-size: 0.9rem;
        }

        /* Informations utilisateur */
        .user-info {
            background-color: var(--background);
            border-radius: var(--radius-md);
            box-shadow:
                6px 6px 16px rgba(0, 0, 0, 0.2),
                -6px -6px 16px rgba(255, 255, 255, 0.1);
            padding: 25px;
            margin-bottom: 25px;
            margin-top: 20px; /* üëà ajoute un espace au-dessus */
        }

        .user-info h2 {
            margin-top: 0;
            color: var(--bleu-2);
        }

        .biography {
            background-color: #ffffff;
            border-left: 4px solid var(--bleu-2);
            border-radius: var(--radius-sm);
            padding: 15px;
            font-style: italic;
            color: #333;
            white-space: pre-line;
        }

        h2, h3 {
            color: var(--text);
        }
    </style>
</head>

<body>
<div class="container--lg">

    <!-- Bouton retour -->
    <a href="{{ url_for('profile') }}" class="btn">‚Üê Retour √† mon profil</a>

    <!-- Informations utilisateur -->
    <div class="user-info">
        <h2>{{ user.username }}</h2>
        <p><b>Nom :</b> {{ user.name }}</p>
        <p><b>Nom d'utilisateur :</b> {{ user.username }}</p>
    </div>

    <h3>Biographie</h3>
    {% if user.biography %}
        <div class="biography">{{ user.biography }}</div>
    {% else %}
        <p class="text-muted">Aucune biographie renseign√©e.</p>
    {% endif %}

    <hr>

    <!-- Publications -->
    <h3>üóíÔ∏è Publications</h3>

    {% for post in posts %}
    <div class="card mb-3">
        <div class="card-body">
             <!-- MODIFICATION : Ajout du nom de l'auteur du post avec un lien -->
             <h5 class="card-title mb-2">
                <a href="{{ url_for('user_profile', username=post.author.username) }}" class="text-decoration-none text-dark">
                    {{ post.author.name }}
                </a>
            </h5>
            <p class="card-text">{{ post.content }}</p>
            <small class="text-muted">Post√© le {{ post.date_posted.strftime('%d/%m/%Y √† %H:%M') }}</small>
        </div>

        <div class="post-content">
            {{ post.content }}
        </div>

        <!-- Like du post -->
        {% if current_user %}
        {% set liked = post.id in liked_post_ids %}
        <div class="like-post">
            <form action="{{ url_for('like_post', post_id=post.id) }}" method="POST">
                <button type="submit" class="btn btn-sm {% if liked %}btn-danger{% else %}btn-outline-danger{% endif %}">
                    {% if liked %}‚ù§Ô∏è{% else %}ü§ç{% endif %} ({{ post.likes | length }})
                </button>
            </form>
        </div>
        {% endif %}

        <!-- Section commentaires -->
        <div class="comment-section">
            {% for comment in post.comments %}
            <div class="comment">
                <small>
                    <b>{{ comment.author.username }}</b> : {{ comment.content }} ‚Äî 
                    <span class="text-muted">{{ comment.date_posted.strftime('%d/%m/%Y √† %H:%M') }}</span>
                </small>

                {% if current_user %}
                    {% set liked_comment = comment.id in liked_comment_ids %}
                    <form action="{{ url_for('like_comment', comment_id=comment.id) }}" method="POST">
                        <button type="submit" class="btn btn-sm {% if liked_comment %}btn-danger{% else %}btn-outline-danger{% endif %}">
                            {% if liked_comment %}‚ù§Ô∏è{% else %}ü§ç{% endif %} ({{ comment.likes | length }})
                        </button>
                    </form>
                    
                {% endif %}
            </div>
            {% endfor %}

            {% if current_user %}
            <form action="{{ url_for('create_comment', post_id=post.id) }}" method="POST" class="comment-input">
                <input type="text" name="content" placeholder="√âcrire un commentaire...">
                <button type="submit" class="btn">Envoyer</button>
            </form>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>

</body>
</html>
